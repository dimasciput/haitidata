version: '2'
services:
  geoserver:
    image: kartoza/haitidata_geoserver
    external_links:
    - postgis:postgis
    ports:
    - 32208:8080/tcp
    labels:
      io.rancher.container.pull_image: always
  postgis:
    image: kartoza/haitidata_db
    environment:
      POSTGRES_USER: docker
      POSTGRES_PASS: docker
  django:
    image: kartoza/haitidata_django
    environment:
      DATABASE_HOST: postgis
      DATABASE_NAME: gis
      DJANGO_SETTINGS_MODULE: core.settings.prod_docker
      GEOSERVER_PUBLIC_LOCATION: http://88.99.166.60/api/geoserver/
      LC_ALL: en_US.UTF-8
      RABBITMQ_HOST: rabbitmq
      GEOSERVER_BASE_URL: http://88.99.166.60:32208/geoserver/
      SITEURL: http://88.99.166.60/
    volumes:
    - django-static-data:/home/web/static:rw
    - django-media-data:/home/web/media:rw
    links:
    - postgis:postgis
    - geoserver:geoserver
    labels:
      io.rancher.container.pull_image: always
  nginx:
    image: kartoza/haitidata_nginx
    volumes:
    - django-static-data:/home/web/static:ro
    - django-media-data:/home/web/media:ro
    links:
    - django:django
    - geoserver:geoserver
    ports:
    - 80:8080/tcp
    labels:
      io.rancher.container.pull_image: always
